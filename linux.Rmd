# linux

## 安装和配置

- TP-P53 安装 ubuntu

  参考[这里](https://blogg.bekk.no/how-to-install-ubuntu-18-04-on-lenovo-p1-617a4bdea389)

  1. bios 关闭 `Secure Boot`,  startup 选择 Both (UEFI/legacy), 以从 usb 安装系统
  2. 安装 `Install Ubuntu`， 按 `e` 配置安装选项，以 `set`开始的行修改：`gfxpayload=××text××`；
  下面一行添加`=casper only-ubiquity ××nomodeset××`，不安装`nouveau`驱动，因为机器带了nvidia T2000独显，
  后续要安装对应显卡驱动
  3. 安装系统
  4. 重启,`ctrl + alt + F1`进入命令行安装驱动，因为我们选择了`nomodeset`安装，没有显卡驱动进入图形界面会卡死。
  `sudo ubuntu-drivers autoinstall`，重启即可
  
  检查显卡驱动是否安装成功
  ```sh
  # 看到configuration那里driver=nvidia表示显卡驱动安装成功，如果不采用nomodeset选项安装，默认安装nouveau驱动
  sudo lshw -C display
  # *-display
  #     description: VGA compatible controller
  #     product: NVIDIA Corporation
  #     vendor: NVIDIA Corporation
  #     physical id: 0
  #     bus info: pci@0000:01:00.0
  #     version: a1
  #     width: 64 bits
  #     clock: 33MHz
  #     capabilities: pm msi pciexpress vga_controller bus_master cap_list rom
  #     configuration: driver=nvidia latency=0
  ```

- ubuntu 搜狗输入法乱码

  搜狗输入法需要切换两次才能正确显示，第一次切换拼音显示为乱码
  
  解决办法参考[这里](https://blog.csdn.net/ZHJ123CSDN/article/details/104884258/)
  1. 输入法配置，不要把搜狗输入法放在第一位
  2. 依赖性检查`sudo apt-get install -f`
  3. 删除配置文件后重启
  ```sh
  cd ~/.config
  rm -rf SogouPY* sogou*
  fcitx -r
  ```

- centos 7 升级内核, 一些软件或者驱动（如网卡驱动）需要高版本内核
  
  参考[这里](https://blog.csdn.net/fenglailea/article/details/88740961)

  ```sh
  # 添加elrepo源，elrepo包含了许多硬件相关的软件包的rpm软件仓库
  # 首先倒入public key
  rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
  # 参考http://elrepo.org/tiki/tiki-index.php选择对应系统版本的源
  rpm -Uvh https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm
  
  # 查看可升级的内核
  yum --disablerepo="*" --enablerepo="elrepo-kernel" list available
  
  # 安装最新内核
  yum --enablerepo=elrepo-kernel install kernel-ml
  
  # 更新内核
  grub2-mkconfig -o /boot/grub2/grub.cfg
  
  # 查看系统中的内核
  cat /boot/grub2/grub.cfg |grep menuentry
  
  if [ x"${feature_menuentry_id}" = xy ]; then
    menuentry_id_option="--id"
    menuentry_id_option=""
  export menuentry_id_option
  menuentry 'CentOS Linux (5.5.5-1.el7.elrepo.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-5.5.5-1.el7.elrepo.x86_64-advanced-a2c5cb57-ab41-44c2-b7f8-e3981fc2582d' {
  menuentry 'CentOS Linux (3.10.0-1062.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-1062.el7.x86_64-advanced-a2c5cb57-ab41-44c2-b7f8-e3981fc2582d' 
  
  # 然后根据上一步查看到的内核CentOS Linux (5.5.5-1.el7.elrepo.x86_64) 7 (Core)设置
  grub2-set-default "CentOS Linux (5.5.5-1.el7.elrepo.x86_64) 7 (Core)"
  
  # 重启即可看到新更新的内核
  reboot
  ```
  
- centos 7 安装 Intel `Wi-Fi 6 AX200 160MHz`无线网卡驱动

  [官网](https://www.intel.cn/content/www/cn/zh/support/articles/000005511/network-and-i-o/wireless-networking.html
  上说该网卡要求内核在5.1以上,在升级完内核后，[下载](https://wireless.wiki.kernel.org/_media/en/users/drivers/iwlwifi/iwlwifi-cc-46.3cfab8da.0.tgz)
  驱动，然后按照README中的步骤安装即可
  
  ```sh
  cp iwlwifi-cc-a0-46.ucode /lib/firmware
  ```

- ubuntu 添加 aliyun 源
  
  根据[这里](https://developer.aliyun.com/mirror/ubuntu)选择相应版本的源，以 16.04 xenial为例
  
  ```sh
  # 备份原有文件
  mv /etc/apt/sources.list /etc/apt/sources.list.backup
  
  # 新建文件，添加源
  touch /etc/apt/sources.list
  
  deb-src http://archive.ubuntu.com/ubuntu xenial main restricted # Added by software-properties
  deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted
  deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe # Added by software-properties
  deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted
  deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe # Added by software-properties
  deb http://mirrors.aliyun.com/ubuntu/ xenial universe
  deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
  deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse
  deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse
  deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse # Added by software-properties
  deb http://archive.canonical.com/ubuntu xenial partner
  deb-src http://archive.canonical.com/ubuntu xenial partner
  deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted
  deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe # Added by software-properties
  deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
  deb http://mirr.iyun.com/ubuntu/ xenial-security multiverse
  ```


