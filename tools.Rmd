# tools {#tools}

## git 和 github

- push到github的时候每次都需要输入用户名密码

  首先，克隆到本地的时候选择ssh方式
  
  ```sh
  git clone git@github.com:<repo>
  
  ## 如果本地已经选择https方式克隆，可以先删除原来的远程仓库，重新添加
  ## ssh方式
  # 查看本地clone方式
  git remote -v 
  # 删除远程仓库
  git remote rm origin
  # 重新添加
  git remote add origin git@github.com:<repo>
  ```
  
  然后本地生成ssh密匙添加至github账户，获得访问github权限,详细步骤参考
  [这里](https://github.com/waylau/github-help/blob/master/Generating%20SSH%20keys%20%E7%94%9F%E6%88%90%20SSH%20%E5%AF%86%E9%92%A5.md)
  
  ```sh
  # 一路回车，在~/.ssh文件夹下生成了id_rsa文件
  ssh-keygen -t rsa -C "<github账户邮箱"
  # 拷贝~/.ssh/id_rsa.pub到github账户进行设置
  ```
  最后push即可
  
  ```
  git push --set-upstream origin master
  ```

- 修改commit的message

```sh
# 想要修改的commit的父提交hash值
git rebase -i <commit_hash>
  
# 修改要修改message行首的pick为r(reword)，然后修改该条message，保存退出即可
  
# 如果同时修改github仓库的commit，强制push即可
git push -f
```

- 显示某一次提交中某个文件的变化

```sh
git log <commit_hash> <file_name>
```

- 删除远程仓库(如github)的错误提交，在本地处理好之后，如删除错误提交，然后强制push到远程进行修改

```sh
git push --force
```

- 删除远程分支

```sh
git push origin --delete <remote_branch>
```

- 修改本地仓库关联的远程仓库，提交修改至另一个远程仓库

  ```sh
  git remote set-url origin https://github.com/yiluheihei/beginr.git
  ```

- [删除本地 untracted files](https://stackoverflow.com/questions/61212/how-to-remove-local-untracked-files-from-the-current-git-working-tree)
  
  ```sh
  # 查看哪些文件将被删除
  git clean -n 
  
  # 删除文件
  git clean -f
  
  # 删除文件和文件夹
  git clean -f -d
  
  # 删除 ignore 的文件
  git clean -f -X
  
  # 删除 ignore 和非 ignore 文件
  git clean -f -x
  ```

- unstage `git add`的文件
 
  ```sh
  git reset HEAD <file>
  ```
  
- 忽略本地文件修改

  ```sh
  # 若文件状态为unstage
  git checkout <file>
  
  # 若文件已经通过`git add` stage，首先文件状态修改为unstage
  git reset HEAD <file>
  git checkout <file>
  ```
  
- 拉取远程分支时保持本地修改

  ```sh
  # 备份当前工作区内容，从最近一次提交中读取内容
  git stash
  # 拉取远程分支内容
  git pull <remote branch>
  # 从stash中读取备份的内容
  git stash pop
  ```

- 远程仓库已经有新的commit，在本地开发的时候没有pull到本地，就直接进行修改并
  commit，这时候再push到远程仓库就会提示远程仓库中有本地不存在的commit。这时候就
  需要在远程仓库基础上merge本地的最新commit
  
  ```sh
  # 首先抓取远程仓库数据
  git fetch
  
  # 然后在本地分支内，在origin仓库的基础上变基提交，如果没有冲突，则直接基于远程
  # 仓库合并了本地提交。如果有冲突，则解决冲突后合并
  git rebase origin/master
  ```
- 删除已经提交的文件，并添加到ignore

 ```sh
 # 从版本控制中的index中删除该文件
 git rm -r --cached <file>
 
 # 该文件添加至ignore，然后commit
 git commit
 ```
  

- windows下命令行git中文显示乱码
  
  设置环境变量`LESSCHARSET=utf-8`

## hugo

- 基于hugo采用blogdown建站的时候出现错误`panic: BUG: Expected valid escape code 
after \, but got '\r'.`

  是由于配置文件`config.toml`中采用多行字符中`"""`的换行符引起的`\`,去掉换行符即
  可,参考[这](https://github.com/gcushen/hugo-academic/issues/852).

## docker

- docker 配置国内源
  
  参考[这](http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker),配置
  文件`/etc/docker/daemon.json`中加入中科大源。
  
  ```
  {
    "registry-mirrors": 
      ["https://docker.mirrors.ustc.edu.cn/"]
  }
  ```
  
  然后重启docker服务`sudo systemctl restart docker`。同时也可以添加阿里云源，
  方法是注册阿里云开发账户后，访问https://cr.console.aliyun.com/#/accelerator，
  点击镜像加速器，就看到加速器地址，添加进去即可。
  
## conda

- 设置清华源，参考[此](https://mirror.tuna.tsinghua.edu.cn/help/anaconda/)

  ```sh
  channels:
    - defaults
  show_channel_urls: true
  channel_alias: https://mirrors.tuna.tsinghua.edu.cn/anaconda
  default_channels:
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro
    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
  custom_channels:
    conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
    msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
    bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
    menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
    pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
    simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  ```

- macOS 10.14 Mojave,conda安装包的时候设计到qt就出现错误，如`conda-forge::qt-5.9.7-h93ee506_1'. PermissionError(1, 'Operation not permitted')`

  解决方法[在此](https://github.com/conda/conda/issues/8440#issuecomment-481167572)
  
  ```
  # for base:
  cd ~/anaconda3/bin
  ls *.app
  rm -rf *.app
  conda update --all --yes
  
  # for some_env:
  cd ~/anaconda3/envs/some_env/bin
  ls *.app
  rm -rf *.app
  conda update -n some_env --all --yes
```
  
  